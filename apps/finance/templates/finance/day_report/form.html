{%extends 'core/base.html' %}

{% block page_title_block%}
{%if is_update %}
Ежедневный отчет
{%else%}
Новый ежедневный отчет
{%endif%}
{% endblock%}

{% block navigation_block%}
<a href="{%url 'day_reports-all' %}">Список отчетов</a>
{% endblock%}

{% block body_block%}

{%if is_update %}
<form method="post" action="{%url 'day_reports-delete' object.pk %}">
    {% csrf_token %}
    <input type="submit" value="Удалить">
</form>
{%endif%}

<form method="post">
    {% csrf_token %}
    <input type="submit" value="Сохранить">
    <br>
    <br>
    {{ form.as_p }}
    <br>
    <br>
    <input type="button" value="row +" onClick="addRow()">
    <input type="button" value="row -" onClick="removeRow()">

    <table class="table" id="report_table">
        <thead>
            <tr>
                <th scope="col">Статья</th>
                <th scope="col">Сумма</th>
                <th scope="col">Описание</th>
            </tr>
        </thead>
        <tbody>
        {% for row in rows %}
            <tr onClick="selectRow(this)">
                <td>{{row.fin_object}}</td>
                <td>{{row.total}}</td>
                <td>{{row.description}}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <script type="text/javascript">

        var tableRef = document.getElementById('report_table').getElementsByTagName('tbody')[0];

        var rowTemplate = `
            <td>{{row_form.fin_object}}</td>
            <td>{{row_form.total}}</td>
            <td>{{row_form.description}}</td>
        `
        function selectRow(row) {
            activeRows = tableRef.getElementsByClassName('selected');
            for (let item of activeRows) {
                item.classList.remove("selected")
            }
            row.classList.add("selected")
        }

        function addRow() {
            rowId = tableRef.rows.length
            newRow = tableRef.insertRow(rowId)
            newRow.innerHTML = rowTemplate
            newRow.onclick = function () { selectRow(this) }
        }

        function removeRow() {
            activeRow = tableRef.getElementsByClassName('selected')[0];
            tableRef.deleteRow(activeRow.rowIndex - 1)
        }

    </script>

</form>

{% endblock%}