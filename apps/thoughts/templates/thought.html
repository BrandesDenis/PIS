{% extends 'core/base.html' %}

{% block page_title_block %}
{% endblock %}

{% block body_block %}

{% for error in errors %}
    {{error}}
{% endfor %}

<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <input type="submit" value="Save">


    <input type="button" value="row +" onClick="addNewRow()">
    <input type="button" value="row -" onClick="removeRow()">


    <table class="table table-bordered" id="topics">
        <thead>
            <tr>
                <th scope="col">Темы</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script type="text/javascript">

        tableRef = document.getElementById('topics').getElementsByTagName('tbody')[0];

        rowTemplate = `
            <td>{{topic_row_form.topic}}</td>
        `

        function selectRow(row) {
            activeRows = tableRef.getElementsByClassName('selected');
            for (let item of activeRows) {
                item.classList.remove("selected")
            }
            row.classList.add("selected")
        }

        function addRow(innerHTML) {
            rowId = tableRef.rows.length
            rowHtmlContent = innerHTML.replace('topic', 'topic' + rowId)
            
            newRow = tableRef.insertRow(rowId)
            newRow.innerHTML = rowHtmlContent
            newRow.onclick = function () { selectRow(this) }
        }

        function addNewRow() {
            addRow(rowTemplate)
        }

        function removeRow() {
            activeRow = tableRef.getElementsByClassName('selected')[0];
            tableRef.deleteRow(activeRow.rowIndex - 1)
        }

        {% for topic_row in topics %}
            template = `
            <td>{{topic_row.topic}}</td>
            `
            addRow(template)
        {% endfor %}

    </script>


</form>

{%if is_update%}
<form method="post" action="{%url 'thoughts-delete' object.pk %}">
    {% csrf_token %}
    <input type="submit" value="delete">
</form>
{%endif%}
{% endblock %}